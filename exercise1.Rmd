---
title: "Exercise1"
output: github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(mosaic)
library(knitr)
milk = read.csv("./milk.csv")
greenbuildings = read.csv("./greenbuildings.csv")
```

## Green Buildings

According to the report by the total Excel guru, the reason that she recommends builing a green building is because of the increase in tenant rent which would result in greater profit. However, through our research on this dataset, we have discovered a confounding variable as well as inconsistencies in the dataset that makes her claim less credible.

First, we would like to point out that there is a large disparity in the number of green vs non-green buildings in the dataset.

```{r}
# Disparity between green housing and non green housing
ggplot(greenbuildings, aes(x = green_rating == 1, fill=green_rating)) +
  theme_classic() +
  geom_bar(show.legend = FALSE) +
  labs(y = "Buildings", x = "Green Rating", title = "Green vs Non-Green Housing")

# Add proportion
greenprop <- prop.table(table(greenbuildings$green_rating))

print(kable(greenprop, format = "markdown", col.names = c("Green Rating", "Frequency")))
```

As shown above, over 90% of the dataset is made out of non-green buildings, so there might not be an even comparison between the two. In addition, the confounding variable we discovered as age of the buildings.

```{r}
# Histogram showing proportion of green rating by age
ggplot(greenbuildings, aes(x = age, fill = green_rating == 1)) +
  theme_bw() +
  geom_density(alpha = 0.5) +
  labs(x = "Age of Building", y = "Number of Buildings") +
  scale_fill_discrete(name = "Green Rating")
```

The age category potentially affects Rent, as newer buildings tend to be more expensive due to having modern features, and affects Green Rating, as newer buildings are more likely to have green certifications due to the facts that builders are currently more environmentally conscious and these green certifications are only a recent development (post 1992 and 1993 for Energystar and LEED respectively). We believe that the dataset is distorted by the abundance of older buildings; a housing developer would find a dataset of recent buildings to be more relevant. A better solution would be to look at buildings less than 10 years old, as shown in the plot below. This analysis indicates that recently built green buildings in fact have a lower median Rent by about $2.5.

```{r}
ggplot(filter(greenbuildings, age < 10 ), aes(fill = factor(green_rating), x = factor(green_rating), y = Rent)) +
  labs(x = "Green Rating", y = "Rent", title = "Rent vs Green Rating for Buildings < 10 Years")+
  geom_boxplot()
test = filter(greenbuildings, age < 10) %>%
  group_by(green_rating) %>%
  summarise(median_rent = median(Rent))
print(kable(test, format = "markdown", col.names = c("Green Rating", "Median Rent")))
```

## Milk Report
### The Approach: 

Using the guidelines from step 1 on the milk assignment, we used the variables N: net profit, Q: quantity sold, and c: unit cost to form the equation that follows.
N = QP - Qc
which simplifies to 
N = Q(P-C)
P and Q are coupled since the price of a product affects the amount sold. As such, Q can be expressed as a function of P as follows:
N = f(P) * (P - C)

We used a scatter plot to illustrate the relationship between P and Q. 
```{r}
plot(sales ~ price, data=milk)
```

Since the distribution of the points closely resemble that of an exponential function, we plotted another scatter plot comparing log(P) and log(Q) to confirm our hypothesis and linearize the data.
```{r}
plot(log(sales) ~ log(price), data=milk)

abline(lm(log(sales) ~ log(price), data=milk))
```

The data illustrates a clear linear relationship between log(P) and log(Q). We created a regression model and identified the coefficients to find the parameters Beta 1 and Beta 0. 
```{r}
lm_ped = lm(log(sales) ~ log(price), data = milk)
coef(lm_ped)
```
This can be illustrated as the following regression model:
log(Q) = 4.72 - 1.62log(P)
Q = e^(4.72) * P^(-1.62)
We can combine both the first and second equations to illustrate N only in terms of P and c:
N = (P-c) * 110 * P^(-1.62)
With this equation, for any given unit cost c (consider c = 1), we can calculate the max N by plotting a graph of the equation and visually identifying the maximum.
```{r}
curve((x-1)*110*x^(-1.62), from=2, to=3)
```

From this graph, we can identify the max N as $2.61 for a given c of \$1.